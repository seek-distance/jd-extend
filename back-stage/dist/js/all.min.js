var app=angular.module("app",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/home"),t.state("home",{url:"/home",views:{"":{templateUrl:"dist/tpls/home.html",controller:"homeCtr"},"nav@home":{templateUrl:"dist/tpls/nav.html",controller:"navCtr"},"content@home":{templateUrl:"dist/tpls/userMan.html",controller:"userManCtr"}}}).state("login",{url:"/login/:update",templateUrl:"dist/tpls/login.html",controller:"loginCtr"})}]),app.config(["$httpProvider",function(t,e){t.defaults.withCredentials=!0}]),app.controller("index",["$scope","log","$state",function(t,e,o){e.vail().success(function(t){t.hasLogin||sessionStorage.getItem("username")||o.go("login")})}]),app.controller("homeCtr",["$scope","log","$state",function(t,e,o){e.vail().success(function(e){e.hasLogin&&(t.username=e.name)}),t.exit=function(){e.out().success(function(){sessionStorage.removeItem("username"),o.go("login")})}}]),app.controller("navCtr",["$scope","$location",function(t,e){t.nav=[{sref:"home",on:!0,class:"fa-user",content:"用户管理"}]}]),app.controller("loginCtr",["$scope","$state","log","$stateParams",function(t,e,o,n){t.success=!0,"update"==n.update?t.update=!0:t.update=!1,t.updatePwd=function(){var n={newPwd:t.newPwd,oldPwd:t.oldPwd};o.update(n).success(function(t){e.go("home")}).error(function(){alert("原密码错误")})},t.submit=function(){t.data={name:t.username,password:t.password},o.in(t.data).success(function(o){"login ok"==o.msg?(sessionStorage.setItem("username",t.username),t.success=!0,e.go("home")):t.success=!1}).error(function(){t.success=!1})}}]),app.controller("userManCtr",["$scope","user",function(t,e){t.user=[],e.get().success(function(e){t.user=e}),t.del=function(o){if(confirm("是否删除该用户")){var n={name:t.user[o].name};e.del(n).success(function(){e.get().success(function(e){t.user=e})})}},t.add=function(){var o={name:t.newUser};t.isadmin&&(o.role="admin"),e.add(o).success(function(){e.get().success(function(e){t.user=e}),t.newUser=""})}}]),app.factory("log",["$http",function(t){return{in:function(e){return t({method:"post",url:"http://jddr-api.jymao.com/ds/login",data:e})},out:function(){return t({method:"post",url:"http://jddr-api.jymao.com/ds/logout"})},vail:function(){return t({method:"get",url:"http://jddr-api.jymao.com/ds/has-login"})},update:function(e){return t({method:"post",url:"http://jddr-api.jymao.com/ds/user/new-password",data:e})}}}]),app.factory("user",["$http",function(t){return{get:function(){return t({method:"get",url:"http://jddr-api.jymao.com/ds/g/User"})},del:function(e){return t({method:"DELETE",url:"http://jddr-api.jymao.com/ds/user",data:e})},add:function(e){return t({method:"post",url:"http://jddr-api.jymao.com/ds/user",data:e})},put:function(e){return t({method:"PUT",url:"http://jddr-api.jymao.com/ds/user/new-password",data:e})}}}]),app.factory("classify",["$http",function(t){var e="http://jddr-api.jymao.com/ds/category";return{get:function(){return t({method:"get",url:"http://jddr-api.jymao.com/ds/g/Category"})},update:function(o){return t({method:"post",url:e,data:o})},del:function(o){return t({method:"DELETE",url:e,data:o})}}}]);