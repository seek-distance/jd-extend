var app=angular.module("app",["ui.router"]);app.config(["$stateProvider","$urlRouterProvider",function(t,e){e.otherwise("/home"),t.state("home",{url:"/home",views:{"":{templateUrl:"dist/tpls/home.html",controller:"homeCtr"},"nav@home":{templateUrl:"dist/tpls/nav.html",controller:"navCtr"},"content@home":{templateUrl:"dist/tpls/userMan.html",controller:"userManCtr"}}}).state("login",{url:"/login/:update",templateUrl:"dist/tpls/login.html",controller:"loginCtr"})}]),app.config(["$httpProvider",function(t,e){t.defaults.withCredentials=!0}]),app.controller("index",["$scope","log","$state",function(t,e,n){e.vail().success(function(t){t.hasLogin||sessionStorage.getItem("username")||n.go("login")})}]),app.controller("homeCtr",["$scope","log","$state",function(t,e,n){e.vail().success(function(e){e.hasLogin&&(t.username=e.name)}),t.exit=function(){e.out().success(function(){sessionStorage.removeItem("username"),n.go("login")})}}]),app.controller("navCtr",["$scope","$location",function(t,e){t.nav=[{sref:"home",on:!0,class:"fa-user",content:"用户管理"}]}]),app.controller("loginCtr",["$scope","$state","log","$stateParams",function(t,e,n,o){t.success=!0,"update"==o.update?t.update=!0:t.update=!1,t.updatePwd=function(){var o={newPwd:t.newPwd,oldPwd:t.oldPwd};n.update(o).success(function(t){e.go("home")}).error(function(){alert("原密码错误")})},t.submit=function(){t.data={name:t.username,password:t.password},n.in(t.data).success(function(n){"login ok"==n.msg?(sessionStorage.setItem("username",t.username),t.success=!0,e.go("home")):t.success=!1}).error(function(){t.success=!1})}}]),app.controller("userManCtr",["$scope","user",function(t,e){t.user=[],t.newUser="",e.get().success(function(e){t.user=e}),t.del=function(n){if(confirm("是否删除该用户")){var o={name:t.user[n].name};e.del(o).success(function(){e.get().success(function(e){t.user=e})})}},t.add=function(){if(""===t.newUser)return void document.querySelector(".newUser").focus();var n={name:t.newUser};t.isadmin&&(n.role="admin"),e.add(n).success(function(){e.get().success(function(e){t.user=e}),t.newUser=""})}}]),app.constant("host","http://jddr-api.jymao.com"),app.factory("log",["$http","host",function(t,e){return{in:function(n){return t({method:"post",url:e+"/ds/login",data:n})},out:function(){return t({method:"post",url:e+"/ds/logout"})},vail:function(){return t({method:"get",url:e+"/ds/has-login"})},update:function(n){return t({method:"post",url:e+"/ds/user/new-password",data:n})}}}]),app.factory("user",["$http","host",function(t,e){return{get:function(){return t({method:"get",url:e+"/ds/g/User"})},del:function(n){return t({method:"DELETE",url:e+"/ds/user",data:n})},add:function(n){return t({method:"post",url:e+"/ds/user",data:n})},put:function(n){return t({method:"PUT",url:e+"/ds/user/new-password",data:n})}}}]),app.factory("classify",["$http","host",function(t,e){var n=e+"/ds/category";return{get:function(){return t({method:"get",url:e+"/ds/g/Category"})},update:function(e){return t({method:"post",url:n,data:e})},del:function(e){return t({method:"DELETE",url:n,data:e})}}}]);